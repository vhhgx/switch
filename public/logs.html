<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>è¯·æ±‚æ—¥å¿—ç›‘æ§ - Claude Proxy Switcher</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: #0d1117;
        color: #c9d1d9;
        padding: 20px;
      }
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }
      h2 {
        color: #58a6ff;
      }
      .actions {
        display: flex;
        gap: 10px;
      }
      button {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
      }
      .btn-primary {
        background: #238636;
        color: white;
      }
      .btn-primary:hover {
        background: #2ea043;
      }
      .btn-danger {
        background: #da3633;
        color: white;
      }
      .btn-danger:hover {
        background: #f85149;
      }
      .btn-secondary {
        background: #21262d;
        color: #c9d1d9;
        border: 1px solid #30363d;
      }
      .btn-secondary:hover {
        background: #30363d;
      }
      .table-container {
        background: #161b22;
        border-radius: 6px;
        border: 1px solid #30363d;
        overflow: hidden;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      thead {
        background: #0d1117;
      }
      th {
        padding: 12px 16px;
        text-align: left;
        font-weight: 600;
        font-size: 12px;
        color: #8b949e;
        text-transform: uppercase;
        border-bottom: 1px solid #30363d;
      }
      tbody tr {
        border-bottom: 1px solid #21262d;
      }
      tbody tr:hover {
        background: #0d1117;
      }
      td {
        padding: 12px 16px;
        font-size: 14px;
      }
      .status-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
      }
      .status-200 {
        background: #1a7f37;
        color: #aff5b4;
      }
      .status-401, .status-402, .status-403, .status-404, .status-429 {
        background: #da3633;
        color: #ffdcd7;
      }
      .status-502, .status-503 {
        background: #9e6a03;
        color: #ffd8b5;
      }
      .protocol-badge {
        background: #ff7b00;
        color: white;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
      }
      .model-text {
        color: #58a6ff;
        font-family: monospace;
        font-size: 13px;
      }
      .token-info {
        font-family: monospace;
        font-size: 12px;
      }
      .token-input {
        color: #79c0ff;
      }
      .token-output {
        color: #a5d6ff;
      }
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #8b949e;
      }
      .empty-state svg {
        width: 64px;
        height: 64px;
        margin-bottom: 16px;
        opacity: 0.5;
      }
      .duration {
        color: #adbac7;
      }
      .time {
        color: #768390;
        font-size: 13px;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h2>ğŸ“Š è¯·æ±‚æ—¥å¿—ç›‘æ§</h2>
      <div class="actions">
        <button class="btn-secondary" onclick="location.href='/'">è¿”å›é¦–é¡µ</button>
        <button class="btn-primary" onclick="loadLogs()">åˆ·æ–°</button>
        <button class="btn-danger" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
      </div>
    </div>

    <div class="table-container">
      <table id="logTable">
        <thead>
          <tr>
            <th>çŠ¶æ€</th>
            <th>æ–¹æ³•</th>
            <th>æ¨¡å‹</th>
            <th>ä¸­è½¬ç«™</th>
            <th>è·¯å¾„</th>
            <th>Token æ¶ˆè€—</th>
            <th>è€—æ—¶</th>
            <th>æ—¶é—´</th>
          </tr>
        </thead>
        <tbody id="logBody">
          <tr class="empty-state">
            <td colspan="8">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
              <div>æš‚æ— è¯·æ±‚æ—¥å¿—</div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <script>
      async function loadLogs() {
        try {
          const res = await fetch('/api/logs')
          const logs = await res.json()

          const tbody = document.getElementById('logBody')

          if (logs.length === 0) {
            tbody.innerHTML = `
              <tr class="empty-state">
                <td colspan="8">
                  <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                  </svg>
                  <div>æš‚æ— è¯·æ±‚æ—¥å¿—</div>
                </td>
              </tr>
            `
            return
          }

          tbody.innerHTML = logs.map(log => {
            const statusClass = `status-${log.status}`
            const time = new Date(log.timestamp).toLocaleTimeString('zh-CN', { hour12: false })
            const model = log.model || 'N/A'
            const modelShort = model.replace('claude-sonnet-4-5-20250929', 'claude-sonne...').replace('claude-', '')
            const provider = log.provider || 'N/A'

            return `
              <tr>
                <td><span class="status-badge ${statusClass}">${log.status}</span></td>
                <td>${log.method}</td>
                <td><span class="model-text">${modelShort}</span></td>
                <td><strong style="color: #58a6ff;">${provider}</strong></td>
                <td style="font-size: 12px; color: #768390;">${log.path}</td>
                <td class="token-info">
                  <span class="token-input">I: ${log.tokenInput}</span><br>
                  <span class="token-output">O: ${log.tokenOutput}</span>
                </td>
                <td class="duration">${log.duration}ms</td>
                <td class="time">${time}</td>
              </tr>
            `
          }).join('')
        } catch (err) {
          console.error('åŠ è½½æ—¥å¿—å¤±è´¥:', err)
        }
      }

      async function clearLogs() {
        if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ—¥å¿—å—ï¼Ÿ')) return
        await fetch('/api/logs', { method: 'DELETE' })
        loadLogs()
      }

      // è‡ªåŠ¨åˆ·æ–°ï¼ˆæ¯ 3 ç§’ï¼‰
      loadLogs()
      setInterval(loadLogs, 3000)
    </script>
  </body>
</html>
